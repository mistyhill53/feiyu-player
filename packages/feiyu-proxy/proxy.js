import M from'axios';function c(e,t=false){try{return t?JSON.stringify(e,void 0,4):JSON.stringify(e)}catch{return}}function u(e){if(e!=null)try{return JSON.parse(e)}catch{return}}function I(e){return Number.isNaN(e)}function g(e){return e==null}function N(e){return !g(e)}function f(e){return (e==null?void 0:e.size)??false?false:I(e)||g(e)||A(e)&&(e.length<1||!/\S/.test(e))||P(e)&&e.length<1||p(e)&&Object.keys(e).length<1}function b(e){return !f(e)}function A(e){return typeof e=="string"}function P(e){return Array.isArray(e)}function p(e){return typeof e=="object"&&N(e)}var j=e=>e.Type==="Timer",q=e=>e.requestContext!=null,O=e=>{let t={};for(let[r,n]of Object.entries(e))n===""&&(t[r]=void 0),n==="true"&&(t[r]=true),n==="false"&&(t[r]=false),/^(0|-?[1-9]\d*)$/.test(n)&&(t[r]=parseInt(n,10)),t[r]=n;return t},F=["x-api-requestid","x-b3-traceid","x-api-scheme","requestsource","referer","host","endpoint-timeout","x-qualifier","accept-encoding"],l=(e,t=F)=>{let r={};for(let[n,o]of Object.entries(e??{}))t.includes(n.toLowerCase())||(r[n]=o);return r},v=e=>{if(j(e))return e=e,{isTimer:true,name:e.TriggerName,time:e.Time,message:e.Message};if(q(e)){e=e;let t=e.headers["user-agent"],r=e.headers["x-b3-traceid"];return {isAPI:true,stage:e.requestContext.stage,method:e.httpMethod,path:e.path,headers:e.headers,query:O(e.queryString),data:u(e.body)??(b(e.body)?e.body:void 0),userAgent:t,traceid:r,sourceIp:e.requestContext.sourceIp}}};var H={json:"application/json; charset=utf-8",html:"text/html; charset=utf-8",text:"text/plain; charset=utf-8",xml:"text/xml; charset=utf-8"},m=(e,t)=>{let{code:r=200,type:n="json",headers:o}=t??{};return {isBase64Encoded:false,statusCode:r,headers:{"content-type":H[n]??n,...o,"access-control-allow-origin":"*","access-control-allow-headers":"*"},body:n.toLowerCase().includes("json")?c(e):e}};var x="x-proxy-target",w="x-proxy-headers",_=m("Hello world!",{type:"text"}),T=async e=>{let t=v(e),{path:r,method:n,headers:o,query:C,data:S}=t;if(r!=="/proxy"||f(o[x]))return _;let d=o[x],y=u(o[w])??{},k=l(o,["host","origin","referer","x-api-scheme","x-api-requestid","x-forwarded-host","x-forwarded-proto","x-forwarded-port","x-forwarded-for","x-real-ip","x-b3-traceid","x-api-scheme","x-qualifier","requestsource","endpoint-timeout","accept-encoding",x,w,...Object.keys(y)]),s=await M({method:n,url:d,params:C,data:S,headers:{...k,...y,referer:d,origin:new URL(d).origin}}).catch(h=>(console.error(h.toString()),h.response));return m(s==null?void 0:s.data,{code:s==null?void 0:s.status,headers:l(s==null?void 0:s.headers,["content-length","access-control-allow-origin","access-control-allow-headers"])})};var E=e=>({httpMethod:e.method??"POST",isBase64Encoded:false,path:e.path??"/svg-avatar",body:p(e.data)?c(e.data):e.data,queryString:e.query??{},headers:{"user-agent":e.userAgent??"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:106.0) Gecko/20100101 Firefox/106.0","x-api-requestid":e.traceid??"22293325848152463c398df3e21c7389","x-b3-traceid":e.traceid??"22293325848152463c398df3e21c7389","x-api-scheme":"https",...e.headers},requestContext:{path:e.path??"/svg-avatar",serviceId:"service-886k0uiy",sourceIp:e.sourceIp??"50.7.158.186",stage:e.stage??"release"}});async function D(e,t){var o;let r=E({method:e.method,path:(o=e.url)==null?void 0:o.replace("/api",""),headers:e.headers,query:e.query,data:e.body}),n=await T(r);t.writeHead(n.statusCode,n.headers),t.end(n.body);}export{D as default};
